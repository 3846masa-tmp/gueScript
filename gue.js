String.prototype.replaceAll = function(org, dest) {
  return this.split(org).join(dest);
};

var replaceList = [
  ["0",'$.____+'],
  ["1",'$.___$+'],
  ["2",'$.__$_+'],
  ["3",'$.__$$+'],
  ["4",'$._$__+'],
  ["5",'$._$_$+'],
  ["6",'$._$$_+'],
  ["7",'$._$$$+'],
  ["8",'$.$___+'],
  ["9",'$.$__$+'],
  ["a",'$.$____+'],
  ["b",'$.$___$+'],
  ["c",'$.$__$_+'],
  ["d",'$.$__$$+'],
  ["e",'$.$_$__+'],
  ["f",'$.$_$_$+'],
  ["\\",'$._____+'],
  ["u",'$.$$$$$+']
];

function js2gs(js) {
  var codedLine = [];
  var capacity = 100;
  for (var i=0; js.substr(i,capacity).length > 0; i+=capacity) {
    var js_small = js.substr(i,capacity);
    var str = "";
    js_small.split('').forEach(function(char){
      str += "\\u"+("000"+char.charCodeAt(0).toString(16)).slice(-4);
    });

    replaceList.forEach(function(table){
      str = str.replaceAll(table[0],table[1]);
    });
    codedLine.push('$.$____$+='+str.slice(0,-1)+";\n");
  }

  var template = ['$=+[];$={____:$++,___$:$++,__$_:$++,__$$:$++,_$__:$++,_$_$:$++,_$$_:$++,_$$$:$++,$___:$++,$__$:$++,$:!!{}+"",_:!{}+"",$_:{}.$+"",$$:{}+""};$.$____=$._[$.___$];$.$___$=$.$$[$.__$_];$.$__$_=$.$$[$._$_$];$.$__$$=$.$_[$.__$_];$.$_$__=$.$[$.__$$];$.$_$_$=$._[$.____];$.$$$$$=$.$_[$.____];$._____="\\\\";$.$____$="";','($.____)[$.$$[$._$_$]+$.$$[$.___$]+$.$_[$.___$]+$._[$.__$$]+$.$[$.____]+$.$[$.___$]+$.$_[$.____]+$.$$[$._$_$]+$.$[$.____]+$.$$[$.___$]+$.$[$.___$]][$.$$[$._$_$]+$.$$[$.___$]+$.$_[$.___$]+$._[$.__$$]+$.$[$.____]+$.$[$.___$]+$.$_[$.____]+$.$$[$._$_$]+$.$[$.____]+$.$$[$.___$]+$.$[$.___$]]("("+$.____+")"+"[\\""+$.$$[$._$_$]+$.$$[$.___$]+$.$_[$.___$]+$._[$.__$$]+$.$[$.____]+$.$[$.___$]+$.$_[$.____]+$.$$[$._$_$]+$.$[$.____]+$.$$[$.___$]+$.$[$.___$]+"\\"][\\""+$.$$[$._$_$]+$.$$[$.___$]+$.$_[$.___$]+$._[$.__$$]+$.$[$.____]+$.$[$.___$]+$.$_[$.____]+$.$$[$._$_$]+$.$[$.____]+$.$$[$.___$]+$.$[$.___$]+"\\"](\\""+$.$____$+"\\")("+$.___$+")")($.___$)'];

  var script = template[0]+codedLine.join('')+template[1];
  script = script.replaceAll("$","ぐえ").replaceAll("_","ぐぇ");
  return script;
}

window.addEventListener('load', function(){
  document.querySelector('#javascript').addEventListener('input', function(){
    document.querySelector('#guescript').value = js2gs(this.value);
  });
});